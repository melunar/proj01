<!DOCTYPE html>
<html lang="cn">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="">

    <style>
        /* ... */
    </style>
    <script src="../../js/jquery.min.js"></script>
    <script src="../../js/json.js" ></script>
    <title>ajax</title>
</head>
<body>
<script>
/*
json.json
    {
        "fullname": "Sean Kelly",
            "org": "SK Consulting",
            "emailaddrs": [
        {"type": "work", "value": "kelly@seankelly.biz"},
        {"type": "home", "pref": 1, "value": "kelly@seankelly.tv"}
    ],
            "telephones": [
        {"type": "work", "pref": 1, "value": "+1 214 555 1212"},
        {"type": "fax", "value": "+1 214 555 1213"},
        {"type": "mobile", "value": "+1 214 555 1214"}
    ],
            "addresses": [
        {"type": "work", "format": "us",
            "value": "1234 Main StnSpringfield, TX 78080-1216"},
        {"type": "home", "format": "us",
            "value": "5678 Main StnSpringfield, TX 78080-1316"}
    ],
            "urls": [
        {"type": "work", "value": "http://seankelly.biz/"},
        {"type": "home", "value": "http://seankelly.tv/"}
    ]
    }*/
        function showjson(j) {
            //假设数据类型只有对象  字符串，数值
            for(var item in j){
                if(((typeof j[item]) != 'object') && ((typeof j[item]) != 'array')){
                    console.log(item + ": " + j[item]);
                }/* else if((typeof j[item]) != 'object') {
                    /!*array*!/
                    console.log(item + ":");
                    for(j in j[item]) {
                        console.log(j[item].j + " ");
                    }
                }*/ else {
                    console.log(j[item] + ": ");
                    showjson(j[item]);
                }

            }

        }
        function showjs(j) {
            for(var item in j){
                    console.log(item + ": " + j[item]);
                }
        }
    function initxhr(xhr){
        if(window.XMLHttpRequest){
            xhr = new XMLHttpRequest();//全局的

        }else if(window.ActionXObject){
            xhr = new ActiveXObject("Msxml2.XMLHTTP");
        }else{
            throw new Error("xhr is not supported");
        }
        return xhr;
    }
    function doajax() {
        var xhr = null;
        if(xhr == null) {
            xhr = initxhr(xhr);
        }

        xhr.open("get","json.json",true);
        xhr.send();
        xhr.onreadystatechange =  function() {
            if(xhr.readyState == 4 && xhr.status == 200) {

                //注意 在转换为json对象时 数组类型的值会被转化为对象（下标+值 => 键值对）

                //var resp = eval("(" + xhr.responseText + ")"); //不安全 使用下面的
                var resp = $.parseJSON(xhr.responseText);
                //console.log(typeof resp);
                console.log(resp.fullname);
                console.log(typeof resp.fullname);
                console.log(typeof resp.age);
                showjson(resp);
                console.log(resp.emailaddrs[0].type);
                console.log(typeof resp.emailaddrs);//object
                console.log(resp.emailaddrs.length);//2
                console.log(resp.emailaddrs[1]);
                //console.log(resp.length); undefine
            }
        }

    }

/*
url: 要求为String类型的参数，（默认为当前页地址）发送请求的地址。

type: 要求为String类型的参数，请求方式（post或get）默认为get。注意其他http请求方法，例如put和
delete也可以使用，但仅部分浏览器支持。

timeout: 要求为Number类型的参数，设置请求超时时间（毫秒）。此设置将覆盖$.ajaxSetup()方法的全局设
置。

async：要求为Boolean类型的参数，默认设置为true，所有请求均为异步请求。
如果需要发送同步请求，请将此选项设置为false。注意，同步请求将锁住浏览器，用户其他操作必须等
待请求完成才可以执行。

cache：要求为Boolean类型的参数，默认为true（当dataType为script时，默认为false）。
设置为false将不会从浏览器缓存中加载请求信息。

data: 要求为Object或String类型的参数，发送到服务器的数据。如果已经不是字符串，将自动转换为字符串格
式。get请求中将附加在url后。防止这种自动转换，可以查看processData选项。对象必须为key/value格
式，例如{foo1:"bar1",foo2:"bar2"}转换为&foo1=bar1&foo2=bar2。如果是数组，JQuery将自动为不同
值对应同一个名称。例如{foo:["bar1","bar2"]}转换为&foo=bar1&foo=bar2。

dataType: 要求为String类型的参数，预期服务器返回的数据类型。如果不指定，JQuery将自动根据http包mime
信息返回responseXML或responseText，并作为回调函数参数传递。
可用的类型如下：
    xml：返回XML文档，可用JQuery处理。
    html：返回纯文本HTML信息；包含的script标签会在插入DOM时执行。
    script：返回纯文本JavaScript代码。不会自动缓存结果。除非设置了cache参数。注意在远程请求
    时（不在同一个域下），所有post请求都将转为get请求。
    json：返回JSON数据。
    jsonp：JSONP格式。使用SONP形式调用函数时，例如myurl?callback=?，JQuery将自动替换后一个
    “?”为正确的函数名，以执行回调函数。
    text：返回纯文本字符串。

beforeSend：要求为Function类型的参数，发送请求前可以修改XMLHttpRequest对象的函数，例如添加自定义
HTTP头。在beforeSend中如果返回false可以取消本次ajax请求。XMLHttpRequest对象是惟一的参
数。
    function(XMLHttpRequest){
        this;   //调用本次ajax请求时传递的options参数
    }

complete：要求为Function类型的参数，请求完成后调用的回调函数（请求成功或失败时均调用）。
参数：XMLHttpRequest对象和一个描述成功请求类型的字符串。
    function(XMLHttpRequest, textStatus){
        this;    //调用本次ajax请求时传递的options参数
    }

success：要求为Function类型的参数，请求成功后调用的回调函数，有两个参数。
    (1)由服务器返回，并根据dataType参数进行处理后的数据。
    (2)描述状态的字符串。
    function(data, textStatus){
        //data可能是xmlDoc、jsonObj、html、text等等
        this;  //调用本次ajax请求时传递的options参数
        }

error：要求为Function类型的参数，请求失败时被调用的函数。该函数有3个参数，即XMLHttpRequest对象、错
误信息、捕获的错误对象(可选)。
   ajax事件函数如下：
   function(XMLHttpRequest, textStatus, errorThrown){
       //通常情况下textStatus和errorThrown只有其中一个包含信息
       this;   //调用本次ajax请求时传递的options参数
   }

contentType：要求为String类型的参数，当发送信息至服务器时，内容编码类型默认
为"application/x-www-form-urlencoded"。该默认值适合大多数应用场合。
dataFilter：要求为Function类型的参数，给Ajax返回的原始数据进行预处理的函数。
提供data和type两个参数。data是Ajax返回的原始数据，type是调用jQuery.ajax时提供的
dataType参数。函数返回的值将由jQuery进一步处理。
        function(data, type){
            //返回处理后的数据
            return data;
}

global：要求为Boolean类型的参数，默认为true。表示是否触发全局ajax事件。设置为false将不会触发全局

ajax事件，ajaxStart或ajaxStop可用于控制各种ajax事件。

ifModified：要求为Boolean类型的参数，默认为false。仅在服务器数据改变时获取新数据。
            服务器数据改变判断的依据是Last-Modified头信息。默认值是false，即忽略头信息。

jsonp：要求为String类型的参数，在一个jsonp请求中重写回调函数的名字。
       该值用来替代在"callback=?"这种GET或POST请求中URL参数里的"callback"部分，例如
    {jsonp:'onJsonPLoad'}会导致将"onJsonPLoad=?"传给服务器。

username：要求为String类型的参数，用于响应HTTP访问认证请求的用户名。

password：要求为String类型的参数，用于响应HTTP访问认证请求的密码。

processData：要求为Boolean类型的参数，默认为true。默认情况下，发送的数据将被转换为对象（从技术角度
    来讲并非字符串）以配合默认内容类型"application/x-www-form-urlencoded"。如果要发送DOM
    树信息或者其他不希望转换的信息，请设置为false。

scriptCharset：要求为String类型的参数，只有当请求时dataType为"jsonp"或者"script"，并且type是GET时
    才会用于强制修改字符集(charset)。通常在本地和远程的内容编码不同时使用。*/
    /**
     * 所有的选项都可以通过$.ajaxSetup({name1:value1,name2:value2.....})函数来全局设置。
     *
     * */
    function jajax() {
        jQuery.ajax({
            url: "http://localhost:801/ajax/deal.php",
            data: {
                name: "name"
            },
            type: 'get',
            success: function() {
                alert("good");
            }
        });
    }


    function jajax2() {
        $.ajax({
            url: "json.json",    //请求的url地址
            //url: "load.html",
            dataType: "html",   //返回格式为json
            async: true, //请求是否异步，默认为异步
            data: { "username": $("#username").val(), "password": $("#password").val(),"select": $("#selcet").val() },    //参数值
            type: "GET",   //请求方式
            beforeSend: function(xhr) {
                console.log("before send:");
                xhr.setRequestHeader("Cache-Control","no-cache");
                xhr.setRequestHeader("netposa","haoyong");
            },
            success: function(data,status){
               /* $('#resText').empty();   //清空resText里面的所有内容
                var text = '';
                //$.each(data, function(i, status){
                    /!*html += '<div><h6>' + comment['username']
                            + ':</h6><p class="para"' + comment['content']
                            + '</p></div>';*!/
                    for(var i in data) {
                        text += (i + ":" + data[i] + "(" + status + ")   ");
                    }
                    showjson(data);
                //});
                $('#resText').text(text);*/
                $('#resText').html(data);
                console.log(data)
            }
/*            complete: function() {
                alert("Over");
            },
            error: function() {
                alert("bad");
            }*/
        });
    }

</script>
<button onclick="doajax()">发送ajax</button>
<button onclick="jajax()">发送jajax</button>
<button onclick="jajax2()">发送jajax2</button>
<form>
    <input name="username" id="username" value="HSON">
    <input type="password" id="password" value="123123">
    <select id="select">
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3" selected>3</option>
    </select>
</form>
<div id="resText">这是返回值的位置</div>
</body>
</html>